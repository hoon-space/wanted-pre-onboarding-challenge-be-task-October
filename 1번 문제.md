**✍️ 동시에 같은 DB Table row 를 업데이트 하는 상황을 방어하기 위해 어떻게 개발하실 건지 설명해주세요.**

❔️ 동시성

- 서로 다른 사건이 동시에 일어나는 것

❔️ 레이스 컨디션

- 둘 이상의 스레드가 공유 데이터에 액세스할 수 있고 동시에 변경하려고 할 때 발생하는 문제
    1. 둘 이상의 스레드 : 요청
    2. 공유 데이터 : 재고 데이터
    3. 동시에 변경하려고 할 때 : 수량을 업데이트할 때
    4. 발생하는 문제 : 값이 정상적으로 바뀌지 않는 문제

✔️ Database를 활용한 다양한 방법

1. Pessimistic Lock (exclusive lock)
    - 데이터에 락을 걸어서 정합성을 맞추는 방법
    - 다른 트랜잭션에서는 락이 해제되기 전까지 데이터에 접근할 수 없음
    - 데드락이 걸릴 수 있기 때문에 주의해야 함

2. Optimistic Lock
    - 락이 아닌 버전을 이용함으로써 정합성을 맞추는 방법
    - 데이터를 읽은 후에 업데이트할 때 읽은 버전이 맞는지 확인함
    - 읽은 버전에서 수정사항이 생겼을 경우 애플리케이션에서 다시 읽은 후 작업을 수행해야 함

3. Named Lock
    - 이름을 가진 락입니다.
    - 해당 락은 다른 세션에서 획득 및 해제가 불가능
    - 트랜잭션이 종료될 때 락이 자동으로 해제되지 않음
    - 별도의 명령어로 해제하거나 선점 시간이 끝나야 해제됨

✔️ Redis를 활용한 다양한 방법

- Lettuce
    - setnx 명령어를 활용하여 분산락 구현
        - spin lock 방식
        - 스레드가 락을 획득할 수 있는지 반복적으로 확인함

2. Redisson
    - pub-sub 반의 락 구현 제공
        - 채널을 만들고 락을 점유중인 스레드가 대기중인 스레드에게 해제를 알림
        - 별도의 리트라이 로직을 작성할 필요 없음

💡 결론

|문제 상황|선택 방법|
|---|---|
|동시 수정 가능성이 낮은 데이터|낙관적 락|
|동시 수정 가능성이 높은 데이터|비관적 락|
|재시도가 필요하지 않은 경우|Lettuce|
|재시도가 필요한 경우 경우|Redisson|
